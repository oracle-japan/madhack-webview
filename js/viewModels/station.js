"use strict";define(["knockout","omhHelper","mapHelper","ojs/ojarraydataprovider","ojs/ojarraytreedataprovider","ojs/ojlogger","ojs/ojknockout","ojs/ojnavigationlist","ojs/ojswitcher","ojs/ojcollapsible","ojs/ojlistview"],function(e,n,t,o,r,s){function i(e){switch(e){case 1:return["icomoon-icon","icomoon-frustrated2","emotion-negative"];case 2:return["icomoon-icon","icomoon-happy2","emotion-positive"];default:return["icomoon-icon","icomoon-neutral","emotion-neautral"]}}function a(e,n){const t=e-new Date(n).valueOf();return t<18e4?"Just Now":t<36e5?Math.round(t/1e3/60)+"m Ago":t<72e5?"1h Ago":t<108e5?"2h Ago":t<432e5?function(e){const n=e.substring(e.indexOf("T")+1,e.indexOf("+"));return n.substring(0,n.lastIndexOf(":"))}(n):function(e){const n=e.substring(0,e.indexOf("T")),t=n.substring(n.indexOf("-")+1,n.lastIndexOf("-"));switch(t){case"01":return"January";case"02":return"February";case"03":return"March";case"04":return"April";case"05":return"May";case"06":return"June";case"07":return"July";case"08":return"August";case"09":return"September";case"10":return"October";case"11":return"November";case"12":return"December";default:return t}}(n)+" "+function(e){const n=e.substring(e.lastIndexOf("-")+1,e.indexOf("T"));return n.startsWith("0")?n.substring(1):n}(n)}return function(c){const u=this,l=c.parentRouter.observableModuleConfig().params.ojRouter.parameters;u.name=e.observable(),u.address=e.observable(),u.lines=e.observableArray(),u.linesProvider=new o(u.lines,{keyAttributes:"name"}),u.selectedItem=e.observable("route"),u.tweets=e.observableArray(),u.tweetsProvider=new r(u.tweets,{keyAttributes:"id"}),u.connected=function(){const e=l.latlng().substring(0,l.latlng().indexOf(","))/1,o=l.latlng().substring(l.latlng().indexOf(",")+1)/1,r=t.initMap("map",e,o),c=t.initDirectionsService(),d=t.initDirectionsRenderer();d.setMap(r);const m=Date.now();n.getStationsInfo(l.stationName(),l.latlng()).then(function(e){u.name(e.station.name),u.address(e.station.address);const n=t.buildRouteRequest(e.route.origin,e.route.destination);c.route(n,function(e){d.setDirections(e)});for(let n=0;n<e.station.lines.length;n++)u.lines.push({name:e.station.lines[n].name,normal:e.station.lines[n].normal,icon:"css/images/icon_"+e.station.lines[n].name.toLowerCase()+("oracle"===e.station.lines[n].name.toLowerCase()?".png":".svg")});for(let n=0;n<e.mentions.length;n++){const t={id:"c-"+(n+1),category:e.mentions[n].category,children:[]};for(let o=0;o<e.mentions[n].children.length;o++)t.children[o]={id:t.id+"-"+(o+1),datetime:a(m,e.mentions[n].children[o].datetime),emotionClasses:i(e.mentions[n].children[o].emotion),source:e.mentions[n].children[o].source,text:e.mentions[n].children[o].text};t.children.length>0?(t.expanded=!0,t.disabled=!1):(t.expanded=!1,t.disabled=!0),u.tweets.push(t)}},function(e,n,t){s.error("Error: "+n),s.error(t)})}}});